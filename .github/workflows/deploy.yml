name: Deploy to Vercel by Tag

on:
  push:
    tags:
      - "nba-web@*"
      - "epl-web@*"

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ§¾ Check out the code
        uses: actions/checkout@v4

      - name: ðŸ§ª Extract service from tag
        id: extract
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "tag=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "service=${TAG_NAME%@*}" >> $GITHUB_OUTPUT

      - name: ðŸ“¦ Install root dependencies
        run: yarn install --immutable

      - name: ðŸš€ Build & Deploy
        run: |
          cd services/${{ steps.extract.outputs.service }}
          yarn build
          npx vercel deploy --prod --token=${{ secrets.VERCEL_TOKEN }} --yes
